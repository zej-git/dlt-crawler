<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>大乐透冷热动态选号器</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;margin:0;background:#f7f7f7;color:#333}
header{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:30px;text-align:center}
main{max-width:1200px;margin:20px auto;padding:0 15px;display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(360px,1fr))}
.card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:20px;text-align:center}
h2,h3{margin-top:0}
button{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;padding:10px 20px;border-radius:6px;font-size:16px;cursor:pointer;transition:.3s}
button:hover{box-shadow:0 4px 12px rgba(102,126,234,.4)}
.ball{display:inline-block;width:36px;height:36px;line-height:36px;text-align:center;border-radius:50%;margin:4px;font-weight:bold;color:#fff;transition:transform .3s}
.ball:hover{transform:rotate(360deg) scale(1.1)}
.hot{background:#e74c3c}.warm{background:#f39c12}.cold{background:#3498db}
table{width:100%;font-size:13px;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#fafafa}
#stats{display:flex;gap:20px;margin:10px 0}
#copyBtn{margin-top:10px}
</style>
</head>
<body>

<header>
  <h1>大乐透冷热动态选号器</h1>
  <p>策略：前区 3 热 + 1 温 + 1 冷　|　后区 1 热 + 1 温</p>
</header>

<main>
  <section class="card">
    <button onclick="generate()">生成一注</button>
    <div id="result" style="margin-top:15px;font-size:18px"></div>
    <button id="copyBtn" class="btn" onclick="copyNums()" style="display:none;">一键复制</button>
  </section>

  <section class="card">
    <h3>前区冷热分布</h3>
    <div id="stats"></div>
    <table id="frontTable"></table>
  </section>

  <section class="card">
    <h3>后区冷热分布</h3>
    <table id="backTable"></table>
  </section>
</main>

<script>
/* ---------- 全局变量 ---------- */
let draws = [];
let frontStat = {};
let backStat  = {};
let lastFront = [], lastBack = []; // 最后一次生成的号码

/* ---------- 1. 加载数据 ---------- */
async function loadDraws(){
  draws = await fetch('https://dlt-crawler.vercel.app/api/dlt-100').then(r => r.json());
  buildStat();
  render();
  generate();
}
loadDraws();

/* ---------- 2. 统计频次 & 遗漏（兼容期号在号码里） ---------- */
function buildStat(){
  // 初始化
  for(let i=1;i<=35;i++) frontStat[String(i).padStart(2,'0')] = {freq:0,miss:0};
  for(let i=1;i<=12;i++)  backStat [String(i).padStart(2,'0')] = {freq:0,miss:0};

  // 畸形 JSON：front 里第 1 个是期号，跳过；back 正常
  draws.forEach((d,idx)=>{
    const frontNums = (Array.isArray(d.front)?d.front:[d.front]).slice(1); // 去掉期号
    frontNums.forEach(n=>{
      const key = String(n).padStart(2,'0');
      if(frontStat[key]){ frontStat[key].freq++; frontStat[key].miss = idx; }
    });
    const backNums = (Array.isArray(d.back)?d.back:[d.back]);
    backNums.forEach(n=>{
      const key = String(n).padStart(2,'0');
      if(backStat[key]){ backStat[key].freq++; backStat[key].miss = idx; }
    });
  });

  // 计算遗漏
  draws.forEach((d,idx)=>{
    const frontNums = (Array.isArray(d.front)?d.front:[d.front]).slice(1);
    frontNums.forEach(n=>{
      const key = String(n).padStart(2,'0');
      if(frontStat[key]) frontStat[key].miss = idx - frontStat[key].miss;
    });
    const backNums = (Array.isArray(d.back)?d.back:[d.back]);
    backNums.forEach(n=>{
      const key = String(n).padStart(2,'0');
      if(backStat[key]) backStat[key].miss = idx - backStat[key].miss;
    });
  });
}

/* ---------- 3. 冷热分类 ---------- */
function classify(stat){
  const hot=[],warm=[],cold=[];
  for(let n in stat){
    const m = stat[n].miss;
    (m<=3?hot:m<=10?warm:cold).push(n);
  }
  return {hot,warm,cold};
}

/* ---------- 4. 随机选号（带去重） ---------- */
function pick(arr,k){
  const set = new Set(arr.map(n=>String(n).padStart(2,'0')));
  const a   = [...set];
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a.slice(0,k);
}
function generate(){
  const f=classify(frontStat);
  const b=classify(backStat);

  // 前区保底：3热+1温+1冷，不足时跨类补齐
  let fHot=pick(f.hot,3), fWarm=pick(f.warm,1), fCold=pick(f.cold,1);
  if(fHot.length<3) fHot.push(...pick([...f.warm,...f.cold],3-fHot.length));
  if(fWarm.length<1) fWarm.push(...pick([...f.hot,...f.cold],1-fWarm.length));
  if(fCold.length<1) fCold.push(...pick([...f.hot,...f.warm],1-fCold.length));

  // 后区保底：1热+1温，不足时跨类补齐
  let bHot=pick(b.hot,1), bWarm=pick(b.warm,1);
  if(bHot.length<1) bHot.push(...pick(b.warm,1-bHot.length));
  if(bWarm.length<1) bWarm.push(...pick(b.hot,1-bWarm.length));

  // 最终组装并去重
  const front=[...new Set([...fHot,...fWarm,...fCold])].sort();
  const back =[...new Set([...bHot,...bWarm])].sort();

  showResult(front,back,fHot,fWarm,fCold,bHot,bWarm);
}

/* ---------- 5. 页面渲染 + 一键复制 ---------- */
function showResult(front,back,fH,fW,fC,bH,bW){
  lastFront=front; lastBack=back;
  const span=n=>`<span class="ball ${fH.includes(n)||bH.includes(n)?'hot':fW.includes(n)||bW.includes(n)?'warm':'cold'}">${n}</span>`;
  const fHtml=front.map(span).join('');
  const bHtml=back.map(span).join('');
  document.getElementById('result').innerHTML=`前区：${fHtml} <br>后区：${bHtml}`;
  document.getElementById('copyBtn').style.display='inline-block';
}
function copyNums(){
  const text=`前区：${lastFront.join(' ')}  后区：${lastBack.join(' ')}`;
  navigator.clipboard.writeText(text).then(()=>alert('已复制：\n'+text)).catch(()=>alert('复制失败，请手动选中'));
}

/* ---------- 6. 表格渲染 ---------- */
function render(){
  const f=classify(frontStat);
  const b=classify(backStat);
  const fRows=[],bRows=[];
  ['hot','warm','cold'].forEach(type=>{
    (type==='hot'?f.hot:type==='warm'?f.warm:f.cold).forEach(n=>{
      const s=frontStat[n];
      fRows.push(`<tr><td>${n}</td><td>${s.freq}</td><td>${s.miss}</td><td class="${type}">${type==='hot'?'热':type==='warm'?'温':'冷'}</td></tr>`);
    });
    (type==='hot'?b.hot:type==='warm'?b.warm:b.cold).forEach(n=>{
      const s=backStat[n];
      bRows.push(`<tr><td>${n}</td><td>${s.freq}</td><td>${s.miss}</td><td class="${type}">${type==='hot'?'热':type==='warm'?'温':'冷'}</td></tr>`);
    });
  });
  document.getElementById('frontTable').innerHTML='<thead><tr><th>号</th><th>出现次数</th><th>当前遗漏</th><th>冷热</th></tr></thead><tbody>'+fRows.join('')+'</tbody>';
  document.getElementById('backTable').innerHTML  ='<thead><tr><th>号</th><th>出现次数</th><th>当前遗漏</th><th>冷热</th></tr></thead><tbody>'+bRows.join('')+'</tbody>';
  document.getElementById('stats').innerHTML=`  
    <div>前区 热号：${f.hot.join(' ')}</div>  
    <div>前区 温号：${f.warm.join(' ')}</div>  
    <div>前区 冷号：${f.cold.join(' ')}</div>  
  `;
}
</script>
</body>
</html>
